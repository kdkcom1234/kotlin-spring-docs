## exposed 의존성 설치 및 구성

- gradle-kotlin 의존성 설치 및 구성
  : https://github.com/JetBrains/Exposed
- spring boot datasource 및 DB컨피그레이션
  : https://github.com/JetBrains/Exposed/tree/main/exposed-spring-boot-starter

### 의존성 추가

```kotlin

// build.gradle.kt
val exposedVersion: String by project
dependencies {
  // ...

	implementation("org.jetbrains.exposed:exposed-core:$exposedVersion")
	implementation("org.jetbrains.exposed:exposed-crypt:$exposedVersion")
	implementation("org.jetbrains.exposed:exposed-dao:$exposedVersion")
	implementation("org.jetbrains.exposed:exposed-jdbc:$exposedVersion")

	implementation("org.jetbrains.exposed:exposed-java-time:$exposedVersion")

	implementation("org.jetbrains.exposed:exposed-json:$exposedVersion")
	implementation("org.jetbrains.exposed:exposed-money:$exposedVersion")
	implementation("org.jetbrains.exposed:exposed-spring-boot-starter:$exposedVersion")
}

// gradle.properties
exposedVersion=0.42.1

```

### 데이터베이스 구성

```properties

# application.properties
spring.datasource.url=jdbc:mysql://localhost:3306/myapp
spring.datasource.username=root
spring.datasource.password=password1234!
logging.level.Exposed=debug

```

```kotlin

@EnableTransactionManagement
@Configuration
class DatabaseConfiguration (val dataSource: DataSource) {
    @PostConstruct
    fun setup() {
        Database.connect(dataSource)
        transaction {
            // SchemaUtils.createMissingTablesAndColumns(Posts, PostComments)
        }
    }

    @Bean
    fun transactionManager(dataSource: DataSource) =
        FixedSpringTransactionManager(SpringTransactionManager(dataSource))

    class FixedSpringTransactionManager(
        private val stm: SpringTransactionManager
    ) : ResourceTransactionManager by stm, InitializingBean by stm, TransactionManager by stm {
        override fun getTransaction(definition: TransactionDefinition?): TransactionStatus {
            TransactionManager.resetCurrent(null)
            return stm.getTransaction(definition)
        }
    }
}

```
